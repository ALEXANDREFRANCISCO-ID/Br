



<?php
$servername = "https://cpanel.infinityfree.com/panel/indexpl.php?option=mysql&ttt=-1782015568000017408/sql305.infinityfree.com";
$username = "if0_36514929";
$password = "I49431020Alex";
$dbname = "if0_36514929_a";

// Conexão com o banco de dados
$conn = new mysqli($servername, $username, $password, $dbname);
if ($conn->connect_error) {
    die("Connection failed: " . $conn->connect_error);
}

if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $titulo = $_POST['titulo'];
    $nome = $_POST['nome'];
    $ano = $_POST['ano'];
    $preco = $_POST['preco'];
    $autor = $_POST['autor'];
    $descricao = $_POST['descricao'];
    

    // Processar o upload da capa
    $capa = $_FILES['capa']['name'];
    $target_dir = "uploads/";
    $target_file = $target_dir . basename($_FILES["capa"]["name"]);
// Upload do PDF
// Upload do PDF

$link_pdf= $_FILES['link_pdf']['name'];
$pdf_temp = $_FILES['link_pdf']['tmp_name'];
move_uploaded_file($pdf_temp, "uploads/$link_pdf");

    // Selecionar tipo de arquivo
    $imageFileType = strtolower(pathinfo($target_file,PATHINFO_EXTENSION));

    // Verificar se o arquivo é uma imagem
    $check = getimagesize($_FILES["capa"]["tmp_name"]);
    if($check !== false) {
        if (move_uploaded_file($_FILES["capa"]["tmp_name"], $target_file)) {
            echo "O arquivo ". htmlspecialchars( basename( $_FILES["capa"]["name"])). " foi enviado.";
        } else {
            echo "Desculpe, houve um erro ao enviar seu arquivo.";
        }
    } else {
        echo "Arquivo não é uma imagem.";
    }

    // Inserir dados no banco
    $sql = "INSERT INTO livros (titulo, nome, ano, preco, autor, descricao, capa, link_pdf)
            VALUES ('$titulo', '$nome', $ano, $preco, '$autor', '$descricao', '$target_file', '$link_pdf')";

    if ($conn->query($sql) === TRUE) {
        echo "Novo registro criado com sucesso";
    } else {
        echo "Erro: " . $sql . "<br>" . $conn->error;
    }
}

$conn->close();
?>


// Criar conexão
$conn = new mysqli($servername, $username, $password, $dbname);

// Checar conexão
if ($conn->connect_error) {
    die("Connection failed: " . $conn->connect_error);
}

$search_term = $_GET['search'] ?? '';  // Coalesce operator para PHP 7+

// Usando prepared statements para melhorar a segurança
$stmt = $conn->prepare("SELECT id, titulo, nome, ano, preco, autor, capa FROM livros WHERE titulo LIKE CONCAT('%', ?, '%') OR autor LIKE CONCAT('%', ?, '%')");
$stmt->bind_param("ss", $search_term, $search_term);
$stmt->execute();
$result = $stmt->get_result();
?>


<!DOCTYPE html>
<html>
	<head>
		<title>Welcome to ebuy-India online shop</title>
		<link rel="stylesheet" type="text/css" href="css/style.css">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
        
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
    <!-- MDL Icones -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="res/material.cyan-light_blue.min.css">
    <link rel="stylesheet" href="res/material.min.css">
    <link rel="stylesheet" href="font-awesome-4.7.0/css/font-awesome.min.css">
             
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
    <!-- MDL Icones -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <style>
        .mdl-card{
            box-shadow:none;
        }
    </style>
		<script src="/j/homeslideshow.js"></script>
	</head>
	<body style="min-width: 980px;">
		<div class="homepageheader" style="position: relative;">
			<div class="signinButton loginButton">
				<div class="uiloginbutton >
					
					
				</div>
				<div class="uiloginbutton signinButton loginButton" style="">
					
				</div>
			</div>
							
			<div style="float: left; margin: 5px 0px 0px 23px;">
				<a href="index.php">
					<img style=" height: 75px; width: 130px;" src="image/ebuy-india.png">
				</a>
			</div>
			<div class="">
				<div id="srcheader">
					<form id="newsearch" method="get" action="index.php">
                             <input class="mdl-textfield__input" type="text" id="search" name="search" value="<?php echo htmlspecialchars($search_term); ?>">
                             <label class="mdl-textfield__label" for="search">Buscar Livros...</label>
                        </div>
                        <button type="submit" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored">
                            Buscar
                        </button>
					</form>
				<div class="srcclear"></div>
				</div>
			</div>
		</div>
		<div class="home-welcome">
			<div class="home-welcome-text" style="background-image: url(img/headef.jpg); height: 380px; ">
				<h1 style="margin: 0px;">Welcome To ebuy-India</h1>
				<h2> A E-Commerce Website Projects by M.G. Sheikh?</h2>
			</div>
		</div>
		



</head>
<body>
    <div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">
        <main class="mdl-layout__content">
            <div class="mdl-grid">
                <div class="mdl-cell mdl-cell--12-col">
                    <form action="index.php" method="GET">
                        <div class="mdl-textfield mdl-js-textfield mdl-textfield--expandable">
                            <input class="mdl-textfield__input" type="text" id="search" name="search" value="<?php echo htmlspecialchars($search_term); ?>">
                           
                    </form>
                </div>
<style>
   .mdl-card__supporting-text, h2, .mdl-card--border,.mdl{
        text-align:center;
    }
    .orangered{
        color:orangered;
    }
</style><div class="mdl-grid">
                <?php
                if ($result->num_rows > 0) {
                    while ($row = $result->fetch_assoc()) {
                        echo '<div class="mdl-cell mdl-cell--2-col mdl-cell--12-col-tablet mdl-cell--3-col-desktop">';
                        echo '<div class="mdl-card mdl-shadow--2dp">';
                        echo' <div class="mdl">';
                        echo '<img  src="' . htmlspecialchars($row['capa']) . '" alt="' . htmlspecialchars($row['titulo']) . '" style="width:170px;">';
                        echo '</div>';
                        echo '<div class="mdl-card__title">';
                        echo '<h2 class="mdl-card__title-text">' . htmlspecialchars($row["titulo"]) . '</h2>';
                        echo '</div>';
                        echo '<div class="mdl-card__supporting-text">';
                        echo '  <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>';
                echo '<br>';
                              
                        // echo 'Nome: ' . htmlspecialchars($row["nome"]) . '<br>';
                        echo 'Ano: ' . htmlspecialchars($row["ano"]) . '<br>';
                        echo '<p>Preço: <span class="custom-price orangered"> ' . number_format($row["preco"], 2, ',', '.') . 'MT</span></p>';
                        echo 'Autor: ' . htmlspecialchars($row["autor"]) . '</p>';
                        echo '</div>';
                        echo '<div class="mdl-card__actions mdl-card--border">';
                        echo '<a href="detalhes.php?id=' . $row["id"] . '" class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">Detalhes</a>';
                        echo '</div>';
                        echo '</div>';
                        echo '</div>';
                    }
                } else {
                    echo "<div class='mdl-cell mdl-cell--12-col'><p>Nenhum resultado encontrado para '<strong>" . htmlspecialchars($search_term) . "</strong>'.</p></div>";
                }
                $stmt->close();
                $conn->close();
                ?>
            </div>
            </div>
        </main>
    </div>
    <!-- MDL JS -->
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
</body>
</html>
